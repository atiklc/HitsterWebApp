{% extends "base.html" %}
{% block content %}

<div class="card">
  <h2>Admin</h2>

  {% if msg %}<p class="ok">{{ msg }}</p>{% endif %}
  {% if err %}<p class="err">{{ err }}</p>{% endif %}

  <h3>Difficulty (locked after first round is created)</h3>
  <form method="post">
    <input type="hidden" name="action" value="set_difficulty">
    <select name="difficulty" {% if locked %}disabled{% endif %}>
      <option value="easy" {% if difficulty=='easy' %}selected{% endif %}>Easy</option>
      <option value="hard" {% if difficulty=='hard' %}selected{% endif %}>Hard</option>
      <option value="extreme" {% if difficulty=='extreme' %}selected{% endif %}>Extreme</option>
    </select>
    <button class="btn" type="submit" {% if locked %}disabled{% endif %}>Save</button>
  </form>
</div>

<div class="card">
  <h3>Create & open a new round</h3>
  <p class="muted">You can only have ONE open round at a time.</p>
  <form method="post">
    <input type="hidden" name="action" value="create_round">
    <label>Question</label>
    <textarea name="question" rows="2" placeholder='e.g. "Song #3"'></textarea>
    <button class="btn" type="submit">Create + open</button>
  </form>
</div>

<div class="card">
  <h3>Current open round</h3>
  {% if open_round %}
    <p><strong>#{{ open_round.id }}</strong> {{ open_round.question or '' }}</p>

    <form method="post" style="margin-top:10px;">
      <input type="hidden" name="action" value="set_answers">
      <label>Correct song</label>
      <input name="correct_song" value="{{ open_round.correct_song or '' }}">
      <label>Correct artist</label>
      <input name="correct_artist" value="{{ open_round.correct_artist or '' }}">
      <label>Correct year</label>
      <input name="correct_year" value="{{ open_round.correct_year or '' }}">
      <button class="btn" type="submit">Update correct answers</button>
    </form>

    <form method="post" style="margin-top:10px;">
      <input type="hidden" name="action" value="close_round">
      <button class="btn secondary" type="submit">Close & score</button>
    </form>

    <h4 style="margin-top:14px;">Players who submitted</h4>
    {% if played and played|length > 0 %}
      <ul class="list">
        {% for p in played %}
          <li>{{ p.player }} <span class="muted">({{ p.updated_at }})</span></li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="muted">No submissions yet.</p>
    {% endif %}
  {% else %}
    <p class="muted">No open round.</p>
  {% endif %}
</div>

<div class="card">
  <h3>Reset game</h3>
  <form method="post" onsubmit="return confirm('Reset rounds/guesses/history? Players kept.');">
    <input type="hidden" name="action" value="reset_game">
    <button class="btn danger" type="submit">Reset</button>
  </form>
</div>

<div class="card">
  <h3>Players</h3>
  {% if players and players|length > 0 %}
    <table>
      <thead><tr><th>Name</th><th>Created</th></tr></thead>
      <tbody>
        {% for p in players %}
          <tr><td>{{ p.name }}</td><td>{{ p.created_at }}</td></tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="muted">No players yet.</p>
  {% endif %}
</div>

{% endblock %}
